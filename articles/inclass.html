<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<html>
    <head>
        <link rel="stylesheet" type="text/css" href="../css/main.css" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Totally un-authoritative Vala->Lua/Lua->Vala Experiments</title>
    </head>

    <body>
<div id=DontuseValainstancefunctionsthemselves>
<h1>How <strong>Not</strong> to use Vala Functions in a Class from Lua</h1>

<p>This example is not going to compile, because instance functions in classes are
different from functions at global scope. It's here so people, including me,
can study the error and figure out how to call Vala classes from Lua scripts.</p>

<p>In the next example this is corrected by the use of static instead of instance
members.</p>

<h3>Compile Line</h3>

<pre><code>    valac --save-temps --pkg lua -X -llua5.1 luatest.vala -o luatest
</code></pre>

<h3>Full Example Code</h3>

<pre><code>    using Lua;
    namespace LuaTest{
            class LuaTest{
                    int my_func (LuaVM vm) {
                        stdout.printf ("Vala Code From Lua Code! (%f)\n", vm.to_number (1));
                        return 1;
                    }

                    static int main (string[] args) {

                        string code = """
                                print "Lua Code From Vala Code!"
                                my_func(33)
                            """;

                        var vm = new LuaVM ();
                        vm.open_libs ();
                        vm.register ("my_func", my_func);
                        vm.do_string (code);

                        return 0;
                    }
            }
    }
</code></pre>
</div>
